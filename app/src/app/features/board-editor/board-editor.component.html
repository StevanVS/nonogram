<h1
  class="text-secondary mt-10 mb-4 text-center text-5xl font-black sm:text-6xl"
>
  BOARD EDITOR
</h1>

<button
  (click)="onCreate()"
  class="hover:bg-tertiary hover:text-primary-dark bg-accent text-primary-dark mb-4 w-30 cursor-pointer rounded-md px-4 py-2 text-xl font-extrabold"
>
  NEW
</button>

@if (boardList.length === 0) {
  <div class="text-secondary-dark mt-4 text-center">There are no Boards</div>
}
<div
  class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"
>
  @for (b of boardList; track $index) {
    <div
      class="bg-primary text-secondary grid grid-cols-2 gap-2 rounded-md p-4 text-xl"
    >
      <div class="col-span-2 flex items-center justify-between">
        <div class="font-black">{{ b.order }}. {{ b.name }}</div>
        <div class="flex gap-4">
          <button
            (click)="onEdit(b)"
            class="fill-secondary hover:fill-tertiary size-6 cursor-pointer"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640">
              <path
                d="M416.9 85.2L372 130.1L509.9 268L554.8 223.1C568.4 209.6 576 191.2 576 172C576 152.8 568.4 134.4 554.8 120.9L519.1 85.2C505.6 71.6 487.2 64 468 64C448.8 64 430.4 71.6 416.9 85.2zM338.1 164L122.9 379.1C112.2 389.8 104.4 403.2 100.3 417.8L64.9 545.6C62.6 553.9 64.9 562.9 71.1 569C77.3 575.1 86.2 577.5 94.5 575.2L222.3 539.7C236.9 535.6 250.2 527.9 261 517.1L476 301.9L338.1 164z"
              />
            </svg>
          </button>
          <button
            (click)="onDelete(b)"
            class="fill-secondary hover:fill-danger size-6 cursor-pointer"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640">
              <path
                d="M232.7 69.9L224 96L128 96C110.3 96 96 110.3 96 128C96 145.7 110.3 160 128 160L512 160C529.7 160 544 145.7 544 128C544 110.3 529.7 96 512 96L416 96L407.3 69.9C402.9 56.8 390.7 48 376.9 48L263.1 48C249.3 48 237.1 56.8 232.7 69.9zM512 208L128 208L149.1 531.1C150.7 556.4 171.7 576 197 576L443 576C468.3 576 489.3 556.4 490.9 531.1L512 208z"
              />
            </svg>
          </button>
        </div>
      </div>
      <app-img-board
        [imgBoard]="{
          tiles: b.coloredTiles,
          width: b.width,
          height: b.height,
        }"
      />
      <app-img-board
        [imgBoard]="{
          tiles: b.filledTiles,
          width: b.width,
          height: b.height,
        }"
      />
      <div>
        <span class="font-bold">Size: </span>
        {{ b.width }} X {{ b.height }}
      </div>
      <div>
        <span class="font-bold">Sub-Grid: </span>
        {{ b.subGrid }}
      </div>
    </div>
  }
</div>

<app-modal
  #formModal
  [titleText]="board.id == null ? 'NEW BOARD' : 'EDIT BOARD'"
>
  <form
    (submit)="onSubmit()"
    [formGroup]="boardForm"
    class="grid grid-cols-2 gap-4 font-bold"
  >
    <div class="col-span-2">
      <label for="name">NAME</label>
      <input
        class="bg-primary text-secondary-light focus:bg-primary-light hover:bg-primary-light placeholder:text-secondary-dark w-full rounded-md px-4 py-2 text-xl leading-tight placeholder:font-normal focus:outline-none"
        id="name"
        formControlName="name"
        type="text"
        placeholder="Board Name"
        required
      />
      @if (
        boardForm.get("name")?.invalid &&
        (boardForm.get("name")?.touched || submitted)
      ) {
        <ul
          class="bg-danger text-secondary mt-2 list-inside list-disc rounded-md px-4 py-2 font-normal"
        >
          @if (boardForm.get("name")?.hasError("required")) {
            <li>Name is required</li>
          }
          @if (boardForm.get("name")?.hasError("minlength")) {
            <li>Name must be at least 3 characters</li>
          }
          @if (boardForm.get("name")?.hasError("maxlength")) {
            <li>Name must be a maximum of 20 characters</li>
          }
        </ul>
      }
    </div>

    <div>
      <app-img-board-input
        tileType="coloredTiles"
        formControlName="coloredBoard"
      />
      @if (
        boardForm.get("coloredBoard")?.invalid &&
        (boardForm.get("coloredBoard")?.touched || submitted)
      ) {
        <ul
          class="bg-danger text-secondary mt-2 list-inside list-disc rounded-md px-4 py-2 font-normal"
        >
          @if (boardForm.get("coloredBoard")?.hasError("required")) {
            <li>Colored Image is required</li>
          }
        </ul>
      }
    </div>
    <div>
      <app-img-board-input
        tileType="filledTiles"
        formControlName="filledBoard"
      />
      @if (
        boardForm.get("filledBoard")?.invalid &&
        (boardForm.get("filledBoard")?.touched || submitted)
      ) {
        <ul
          class="bg-danger text-secondary mt-2 list-inside list-disc rounded-md px-4 py-2 font-normal"
        >
          @if (boardForm.get("filledBoard")?.hasError("required")) {
            <li>Filled Image is required</li>
          }
        </ul>
      }
    </div>

    @if (
      boardForm.invalid &&
      (boardForm.touched || submitted) &&
      boardForm.hasError("sameDimensions")
    ) {
      <ul
        class="bg-danger text-secondary col-span-2 mt-2 list-inside list-disc rounded-md px-4 py-2 font-normal"
      >
        <li>Image dimensions do not match</li>
      </ul>
    }

    <div>
      <label for="order">ORDER</label>
      <input
        class="bg-primary text-secondary-light focus:bg-primary-light hover:bg-primary-light placeholder:text-secondary-dark w-full rounded-md px-4 py-2 text-xl leading-tight placeholder:font-normal focus:outline-none"
        id="order"
        appDigitsOnly
        formControlName="order"
        type="number"
        placeholder="0"
      />
      @if (
        boardForm.get("order")?.invalid &&
        (boardForm.get("order")?.touched || submitted)
      ) {
        <ul
          class="bg-danger text-secondary mt-2 list-inside list-disc rounded-md px-4 py-2 font-normal"
        >
          @if (boardForm.get("order")?.hasError("required")) {
            <li>Order is required</li>
          }
          @if (boardForm.get("order")?.hasError("pattern")) {
            <li>Order must be a number</li>
          }
          @if (boardForm.get("order")?.hasError("min")) {
            <li>Order must be greater or equal to 0</li>
          }
        </ul>
      }
    </div>

    <div>
      <label for="subGrid">SUB-GRID</label>
      <input
        class="bg-primary text-secondary-light focus:bg-primary-light hover:bg-primary-light placeholder:text-secondary-dark w-full rounded-md px-4 py-2 text-xl leading-tight placeholder:font-normal focus:outline-none"
        id="subGrid"
        appDigitsOnly
        formControlName="subGrid"
        type="number"
        placeholder="0"
      />
      @if (
        boardForm.get("subGrid")?.invalid &&
        (boardForm.get("subGrid")?.touched || submitted)
      ) {
        <ul
          class="bg-danger text-secondary mt-2 list-inside list-disc rounded-md px-4 py-2 font-normal"
        >
          @if (boardForm.get("subGrid")?.hasError("pattern")) {
            <li>Sub Grid must be a number</li>
          }
          @if (boardForm.get("subGrid")?.hasError("min")) {
            <li>Sub Grid must be greater or equal to 0</li>
          }
        </ul>
      }
    </div>

    <button
      type="submit"
      class="hover:bg-tertiary hover:text-primary-dark bg-accent text-primary-dark col-span-2 mt-4 cursor-pointer rounded-md px-4 py-2 text-xl font-extrabold"
    >
      {{ board.id == null ? "CREATE" : "UPDATE" }}
    </button>
  </form>
</app-modal>

<app-modal #deleteModal titleText="DELETE BOARD" [canCloseOnClickOutside]="true">
  <div class="pb-8 text-xl">Are you sure you want to delete this board?</div>
  <div class="flex flex-row-reverse gap-2">
    <button
      (click)="delete()"
      class="hover:bg-tertiary hover:text-primary-dark bg-danger text-secondary cursor-pointer rounded-md px-4 py-2 text-xl font-extrabold"
    >
      DELETE
    </button>
    <button
      (click)="deleteModal.closeModal()"
      class="hover:bg-tertiary hover:text-primary-dark bg-primary-light text-secondary cursor-pointer rounded-md px-4 py-2 text-xl font-extrabold"
    >
      CANCEL
    </button>
  </div>
</app-modal>
